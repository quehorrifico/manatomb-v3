{{ define "settings" }}
  {{ template "layout_header" . }}
  {{ $d := .Data }}

  <main class="max-w-3xl mx-auto py-10 px-4 space-y-6">

    <header class="space-y-1">
      <h2 class="text-2xl font-semibold tracking-tight">
        <span class="bg-gradient-to-br from-sky-400 via-cyan-300 to-slate-100 bg-clip-text text-transparent">
          Account settings
        </span>
      </h2>
      <p class="text-sm text-slate-400">
        Manage your Mana Tomb profile and account.
      </p>
    </header>

    <!-- Profile summary -->
    <section class="rounded-xl border border-slate-800 bg-slate-950/80 p-4 text-sm text-slate-200 shadow-md shadow-sky-500/10">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400 mb-2">
        Profile
      </h3>
      <p><span class="text-slate-400">Display name:</span> {{ .CurrentUser.DisplayName }}</p>
      <p><span class="text-slate-400">Email:</span> {{ .CurrentUser.Email }}</p>
    </section>

    <!-- Update profile (display name only) -->
    <section class="rounded-xl border border-slate-800 bg-slate-950/80 p-4 shadow-md shadow-sky-500/10">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400 mb-3">
        Update profile
      </h3>
      <form method="POST" action="/settings" class="space-y-4">
        <input type="hidden" name="action" value="update_profile">

        <div class="text-sm text-slate-200">
          <label class="block">
            <span class="block text-xs font-medium text-slate-400 mb-1">Display name</span>
            <input
              type="text"
              name="display_name"
              value="{{ $d.DisplayName }}"
              required
              class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2
                     text-sm text-slate-100 placeholder:text-slate-500
                     focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400">
          </label>
        </div>
        <p class="text-xs text-slate-500">
          Display name can include letters, numbers, spaces, and basic punctuation only.
        </p>

        <div class="flex justify-end">
          <button type="submit"
                  class="inline-flex items-center px-4 py-2 rounded-md
                         bg-sky-500 text-slate-950 text-sm font-semibold
                         hover:bg-sky-400 transition-colors
                         focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-slate-950">
            Save changes
          </button>
        </div>
      </form>
    </section>

    <!-- Change password -->
    <section class="rounded-xl border border-slate-800 bg-slate-950/80 p-4 shadow-md shadow-sky-500/10">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400 mb-3">
        Change password
      </h3>
      <form method="POST" action="/settings" class="space-y-4">
        <input type="hidden" name="action" value="change_password">

        <div class="text-sm text-slate-200">
          <label class="block">
            <span class="block text-xs font-medium text-slate-400 mb-1">Current password</span>
            <input
              type="password"
              name="current_password"
              required
              class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2
                     text-sm text-slate-100 placeholder:text-slate-500
                     focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400">
          </label>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
          <div class="text-sm text-slate-200">
            <label class="block">
              <span class="block text-xs font-medium text-slate-400 mb-1">New password</span>
              <input
                type="password"
                name="new_password"
                required
                class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2
                       text-sm text-slate-100 placeholder:text-slate-500
                       focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400">
            </label>
          </div>
          <div class="text-sm text-slate-200">
            <label class="block">
              <span class="block text-xs font-medium text-slate-400 mb-1">Confirm new password</span>
              <input
                type="password"
                name="confirm_password"
                required
                class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2
                       text-sm text-slate-100 placeholder:text-slate-500
                       focus:outline-none focus:ring-1 focus:ring-sky-400 focus:border-sky-400">
            </label>
          </div>
        </div>

        <div class="flex justify-end">
          <button type="submit"
                  class="inline-flex items-center px-4 py-2 rounded-md
                         bg-sky-500 text-slate-950 text-sm font-semibold
                         hover:bg-sky-400 transition-colors
                         focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-slate-950">
            Update password
          </button>
        </div>
      </form>
    </section>

    <!-- Sign out -->
    <section class="rounded-xl border border-slate-800 bg-slate-950/80 p-4 shadow-md shadow-sky-500/10">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-400 mb-3">
        Sign out
      </h3>
      <p class="text-xs text-slate-500 mb-3">
        End your current session on this device.
      </p>
      <form method="GET" action="/logout">
        <button type="submit"
                class="inline-flex items-center px-4 py-2 rounded-md
                       border border-slate-700 bg-slate-900 text-xs font-semibold text-slate-200
                       hover:border-sky-400 hover:text-sky-300 transition-colors">
          Sign out
        </button>
      </form>
    </section>

    <!-- Danger zone -->
    <section class="rounded-xl border border-red-900/70 bg-red-950/50 p-4 shadow-md shadow-red-900/40">
      <h3 class="text-xs font-semibold uppercase tracking-wide text-red-300 mb-2">
        Danger zone
      </h3>
      <p class="text-xs text-red-100 mb-3">
        Deleting your account will remove your profile, decks, and sessions. This action cannot be undone.
      </p>
      <form method="POST" action="/settings"
            onsubmit="return confirm('Delete your account and all decks? This cannot be undone.');">
        <input type="hidden" name="action" value="delete_account">
        <button type="submit"
                class="inline-flex items-center px-4 py-2 rounded-md border border-red-500/70
                       bg-red-900/60 text-xs font-semibold text-red-50
                       hover:bg-red-700/80 hover:border-red-400 transition-colors">
          Delete account
        </button>
      </form>
    </section>

  </main>

  {{ template "layout_footer" . }}
{{ end }}